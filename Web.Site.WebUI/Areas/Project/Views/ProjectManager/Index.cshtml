@{
    ViewBag.Title = "项目管理";
}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header"><h4>项目列表</h4></div>
            <div class="card-toolbar clearfix">
                <form class="pull-left search-bar" method="post" action="#!" role="form">
                    <div class="form-group">
                        <label for="example-input-normal">项目名称</label>
                        <input class="form-control" type="text" id="projectName" placeholder="项目名称..">
                    </div>
                </form>
                <div class="toolbar-btn-action" style="float:right">
                    <a class="btn btn-success m-r-5" href="#!" onclick="Search(1)"><i class="mdi mdi-magnify"></i> 查询</a>
                    <button type="button" class="btn btn-primary m-r-5" data-toggle="modal" onclick="OpenCreateProjectModal();">
                    <i class="mdi mdi-plus"></i>新增
                    </button>
                    @Html.Partial("Create")
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-bordered" id="tablelist">
                        <thead>
                            <tr>
                                <th>编号</th>
                                <th>项目名称</th>
                                <th>项目负责人</th>
                                <th>项目内容</th>
                                <th>项目联系人</th>
                                <th>联系电话</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <ul class="pagination" id="filter" style="float:right"></ul>
                <ul class="clear" style="clear:both"></ul>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/new/tablequery/tableList.js"></script>
<script>
    var query = {};
    var actionUrl = { ProjectList: "/Project/projectmanager/ProjectList", GetUserList: "/Common/Account/GetUserList" };
    var aoColumns = [
        { "sName": "Id" },
        { "sName": "ProjectName" },
        { "sName": "LeaderName" },
        { "sName": "Content" },
        { "sName": "LinkPerson" },
        { "sName": "LinkPhoneNo" },
        {
            "sName": "Id",
            "fnRender": function (oObj) {
                var btnArray = '<a class="btn btn-xs btn -default" href="#!" title="编辑" onclick="Edit(' + oObj + ') data-toggle="tooltip"><i class="mdi mdi-pencil"></i></a>';
                btnArray += '<a class="btn btn-xs btn-default" href="#!" title="删除"  onclick="Delete(' + oObj + ') data-toggle="tooltip"><i class="mdi mdi-window-close"></i></a>';
                return btnArray;
            }
        }
    ];

    Search(1);

    function Search(index) {
        if (index && index <= 0) {
            index = 1;
        }
        query['PageIndex'] = index;
        query['projectName'] = $("#projectName").val() ? $("#projectName").val() : '';
        tablelist.SearchDataTables($("#tablelist tbody"), $("#filter"), actionUrl.ProjectList, aoColumns, query);
    }

    function CreateProject() {
        if (CheckItem()) {

        }
    }

    function CheckItem() {

    }

    function OpenCreateProjectModal() {
        lightyear.loading('show');
        $.ajax({
            type: 'post',
            url: actionUrl.GetUserList,
            async: false,
            success: function (result) {
                if (result && result.length > 0) {
                    let userHtml = '<option value="0">请选择</option>';
                    result.forEach(i => {
                        userHtml += '<option value="' + i.value + '">' + i.text + '</option>';
                        $('#createModal').modal('show');
                    })
                    $("#ProjectLeader").html(userHtml);
                }
                else {
                    setTimeout(function () { lightyear.notify('无用户数据，请先配置用户', 'warning'); }, 1e3);
                }
                lightyear.loading('hide');
            }
        })
    }
</script>